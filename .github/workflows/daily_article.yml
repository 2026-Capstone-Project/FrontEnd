name: Calio Daily Article Generator

on:
  schedule:
    - cron: "0 15 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install Dependencies
        run: |
          pip install PyGithub google-generativeai python-dotenv

      - name: Run Generator
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          REPO_NAME: ${{ github.repository }} # í™˜ê²½ ë³€ìˆ˜ë¡œ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜
        run: python scripts/generate_article.py

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # ì•ˆì „í•œ íŒŒì¼ ì¶”ê°€ ë°©ì‹ (Copilot ì¶”ì²œ)
          git add articles/ || echo "No articles to add"

          # íƒ€ì„ìŠ¤íƒ¬í”„ ì˜¤ë¥˜ ìˆ˜ì •: bash date ëª…ë ¹ ì‚¬ìš©
          CURRENT_TIME=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          git diff --quiet && git diff --staged --quiet || (git commit -m "docs: ğŸ“ [Calio] ê°œë°œ ì¼ì§€ ìë™ ìƒì„± ($CURRENT_TIME)" && git push)
