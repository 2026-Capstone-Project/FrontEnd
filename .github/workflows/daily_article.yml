name: Calio Daily Article Generator

on:
  schedule:
    - cron: '0 15 * * *' # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë§¤ì¼ ìì • (UTC 15:00)
  workflow_dispatch: # ì§ì ‘ ì‹¤í–‰ ë²„íŠ¼

jobs:
  build:
    runs-on: ubuntu-latest
    permissions: # ì €ì¥ì†Œì— ê¸€ì„ ì¨ì•¼ í•˜ë¯€ë¡œ ê¶Œí•œ í•„ìš”
      contents: write

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ëª¨ë“  ë¸Œëœì¹˜ì™€ íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ í•„ìš”

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install PyGithub google-generativeai python-dotenv

      - name: Run Generator
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python scripts/generate_article.py

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add articles/*.md
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹
          git diff --quiet && git diff --staged --quiet || (git commit -m "docs: ğŸ“ [Calio] ê°œë°œ ì¼ì§€ ìë™ ìƒì„± (${{ github.event.head_commit.timestamp }})" && git push)
