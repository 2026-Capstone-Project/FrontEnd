name: Calio Daily Article Generator

on:
  schedule:
    - cron: "0 15 * * *" # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ë§¤ì¼ ìì • (UTC 15:00)
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼

jobs:
  generate-and-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write # PRì„ ìƒì„±í•˜ê¸° ìœ„í•´ ê¼­ í•„ìš”í•œ ê¶Œí•œ

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ëª¨ë“  ë¸Œëœì¹˜ ì´ë ¥ì„ ê°€ì ¸ì˜´

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install Dependencies
        run: |
          pip install PyGithub google-generativeai python-dotenv

      - name: Run Generator
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          REPO_NAME: ${{ github.repository }}
        run: python scripts/generate_article.py

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GH_TOKEN }}
          commit-message: "docs: ğŸ“ [Calio] ê°œë°œ ì¼ì§€ ìƒì„±"
          branch: auto-daily-log
          delete-branch: true # PRì´ ë¨¸ì§€ë˜ë©´ ë¸Œëœì¹˜ ìë™ ì‚­ì œ
          title: "ğŸ“ [Calio] ì˜¤ëŠ˜ì˜ ê°œë°œ ì•„í‹°í´ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤! ($(date +'%Y-%m-%d'))"
          body: |
            ## ğŸ¤– Calio AI Daily Report
            ì˜¤ëŠ˜ì˜ ì‘ì—… ë‚´ì—­ê³¼ ì½”ë“œ ë³€ê²½ì ì„ ë¶„ì„í•˜ì—¬ ìƒì„±ëœ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.

            - **ë¸Œëœì¹˜:** ëª¨ë“  í™œì„± ë¸Œëœì¹˜ ìŠ¤ìº”
            - **ìƒì„±ì¼:** $(date +'%Y-%m-%d %H:%M KST')

            ë‚´ìš©ì„ ê²€í† í•˜ì‹  í›„ `develop` ë¸Œëœì¹˜ë¡œ ë¨¸ì§€í•´ ì£¼ì„¸ìš”!
          base: develop # PRì„ ë³´ë‚¼ ëŒ€ìƒ ë¸Œëœì¹˜
          labels: |
            documentation
            ai-generated
